
---
## sim配置说明
---
主要用于模拟车辆数据，发送到msg，支持centos6.5及以上系统。

##### 1.配置说明

---

###### 配置文件为msgtool.yaml
---

```
#登陆msg方式，发送数据采用SEND方式
login_type: SEND  
#登陆msg的用户名
user: fx111
#登陆msg的密码
passwd: fx111 
#日志等级，0:简单模式，1:详细模式
log_verbose: 0

#要发送数据msg的ip，port
msghost: 192.168.100.49:57005 

#并发数
send_thread: 1    
#发送模式
send_type: crazy #sim, record, crazy
#crazy模式下的单次模拟车辆数
crazy_num: 10
#sim&record模式下的配置文件，sim模式配置sim号，record下配置拼好的内部协议
path_sim: ./msgtool.txt
#发送总次数
send_time: 10000000
#每轮发送间隔，单位ms
sleep_time: 5000

#record模式下，每条记录发送间隔，单位ms
record_sleep: 1000

#以下配置适用于sim&crazy模式
#oem
oem: 70104
#车牌颜色_车牌省份简称
carid: 2_京
#command_type
command_type: U_REPT    
#type:0
key_type: 0                 
#数据来源，1:hy808; 2:hy809; 3:yy808; 4:yy809
src_type: 1 

#经度
lon: 68874136
#纬度
lat: 15422114
#gps速度
speed: 400
#方向
dir: 0
#海拔
altitude: 4
#vss速度
vssspeed: 10
#基本状态位
basestatus: 0
#扩展状态位
extendstatus: 0
#报警编码
alarmcode: 4

#归属地区域码
local_areacode: 150000
#实时区域码
real_areacode: 140205
```

---

##### 2.命令

./msgtool -v
```
[chenbo@localhost msgtool]$ ./msgtool -v
version 1.0.1. A test program that assembles msg messages.
```
./msgtool -h

```
[chenbo@localhost msgtool]$ ./msgtool -h
Usage:
-v: version info
-h: help info
-c: conf (the conf file sim.yaml follows)
	```

	./msgtool -c msgtool.yaml 

	```
	[chenbo@localhost msgtool]$ ./msgtool  -c msgtool.yaml 
	conf=msgtool.yaml
	2019/03/13 12:15:11 load sim 2
	2019/03/13 12:15:11 访问公网IP地址是： 192.168.100.49:57005
	2019/03/13 12:15:11 客户端链接的地址及端口是：192.168.100.49:54466
	2019/03/13 12:15:11 SEND 192.168.100.49:57005 LOGI SEND fx111 fx111 

	2019/03/13 12:15:11 RECV 192.168.100.49:57005 len:38, LACK 0 0 0 msg@192.168.100.49@57005 

	2019/03/13 12:15:11 Sendto 192.168.100.49:57005 test data by mode: crazy start!
	2019/03/13 12:15:11 SEND 192.168.100.49:57005 NOOP
	2019/03/13 12:15:11 RECV 192.168.100.49:57005 len:11, NOOP_ACK 

	2019/03/13 12:15:11 Worker 0 send 10 records, sleep: 5000ms
	```


##### 3. 示例

	---
	示例1，配置如下：
	- send_thread: 2
	- send_type: crazy
	- crazy_num: 2
	- sleep_time: 5000 
	- oem: 70104
	- carid: 2_京

	```
	2019/03/13 12:25:17 Worker 1 sendto 192.168.100.49:57005 len:210, data:CAITS 0_0 70105_13100010000 150000 U_REPT {TYPE:0,RET:0,1:68874136,2:15422114,3:400,4:20190313/122517,5:0,6:4,7:10,8:0,9:10240,20:4,104:京B10000,202:2,500:0,990:1,998:2_京B10000,999:1552451117,1000:140205} 
	2019/03/13 12:25:17 Worker 0 sendto 192.168.100.49:57005 len:210, data:CAITS 0_0 70104_13100010000 150000 U_REPT {TYPE:0,RET:0,1:68874136,2:15422114,3:400,4:20190313/122517,5:0,6:4,7:10,8:0,9:10240,20:4,104:京A10000,202:2,500:0,990:1,998:2_京A10000,999:1552451117,1000:140205} 
	2019/03/13 12:25:17 RECV 192.168.100.49:57005 len:11, NOOP_ACK 

	2019/03/13 12:25:17 Worker 0 sendto 192.168.100.49:57005 len:210, data:CAITS 0_0 70104_13100010001 150000 U_REPT {TYPE:0,RET:0,1:68874136,2:15422114,3:400,4:20190313/122517,5:0,6:4,7:10,8:0,9:10240,20:4,104:京A10001,202:2,500:0,990:1,998:2_京A10001,999:1552451117,1000:140205} 
	2019/03/13 12:25:17 Worker 0 send 2 records, sleep: 5000ms
	2019/03/13 12:25:17 Worker 1 sendto 192.168.100.49:57005 len:210, data:CAITS 0_0 70105_13100010001 150000 U_REPT {TYPE:0,RET:0,1:68874136,2:15422114,3:400,4:20190313/122517,5:0,6:4,7:10,8:0,9:10240,20:4,104:京B10001,202:2,500:0,990:1,998:2_京B10001,999:1552451117,1000:140205} 
	2019/03/13 12:25:17 Worker 1 send 2 records, sleep: 5000ms


	2019/03/13 12:25:22 Worker 1 sendto 192.168.100.49:57005 len:210, data:CAITS 0_0 70105_13100010000 150000 U_REPT {TYPE:0,RET:0,1:68874137,2:15422115,3:400,4:20190313/122522,5:0,6:4,7:10,8:0,9:10240,20:4,104:京B10000,202:2,500:0,990:1,998:2_京B10000,999:1552451122,1000:140205} 
	2019/03/13 12:25:22 Worker 0 sendto 192.168.100.49:57005 len:210, data:CAITS 0_0 70104_13100010000 150000 U_REPT {TYPE:0,RET:0,1:68874137,2:15422115,3:400,4:20190313/122522,5:0,6:4,7:10,8:0,9:10240,20:4,104:京A10000,202:2,500:0,990:1,998:2_京A10000,999:1552451122,1000:140205} 
	2019/03/13 12:25:22 Worker 0 sendto 192.168.100.49:57005 len:210, data:CAITS 0_0 70104_13100010001 150000 U_REPT {TYPE:0,RET:0,1:68874137,2:15422115,3:400,4:20190313/122522,5:0,6:4,7:10,8:0,9:10240,20:4,104:京A10001,202:2,500:0,990:1,998:2_京A10001,999:1552451122,1000:140205} 
	2019/03/13 12:25:22 Worker 0 send 2 records, sleep: 5000ms
	2019/03/13 12:25:22 Worker 1 sendto 192.168.100.49:57005 len:210, data:CAITS 0_0 70105_13100010001 150000 U_REPT {TYPE:0,RET:0,1:68874137,2:15422115,3:400,4:20190313/122522,5:0,6:4,7:10,8:0,9:10240,20:4,104:京B10001,202:2,500:0,990:1,998:2_京B10001,999:1552451122,1000:140205} 
	2019/03/13 12:25:22 Worker 1 send 2 records, sleep: 5000ms

	并发的时候不同线程支持oem自动累加，防止macid重复
	同一线程支持sim从13100010000自动累加，防止重复

	并发的时候不同线程车牌号自动从A区累加，防止车牌重复
	同一线程车牌号自动累加，防止重复
	综上配置send_thread（2）*crazy（2）= 4 ，一次模拟4辆车。

	同一车辆支持经纬度自动累加，模拟车辆直线行走。

	可以用于性能测试。
	```

	示例2，配置如下：
	- send_thread: 2
	- send_type: sim
	- crazy_num: 2
	- sleep_time: 5000 
	- oem: 70104
	- carid: 2_京

	```
	[chenbo@localhost msgtool]$ cat msgtool.txt 
	18700009651
	18700009652
	```


	```
	2019/03/13 12:35:07 Sendto 192.168.100.49:57005 test data by mode: sim start!
	2019/03/13 12:35:07 SEND 192.168.100.49:57005 NOOP
	2019/03/13 12:35:07 Worker 1 sendto 192.168.100.49:57005 len:210, data:CAITS 0_0 70105_18700009651 150000 U_REPT {TYPE:0,RET:0,1:68874136,2:15422114,3:400,4:20190313/123507,5:0,6:4,7:10,8:0,9:10240,20:4,104:京B10000,202:2,500:0,990:1,998:2_京B10000,999:1552451707,1000:140205} 
	2019/03/13 12:35:07 Worker 1 sendto 192.168.100.49:57005 len:210, data:CAITS 0_0 70105_18700009652 150000 U_REPT {TYPE:0,RET:0,1:68874136,2:15422114,3:400,4:20190313/123507,5:0,6:4,7:10,8:0,9:10240,20:4,104:京B10001,202:2,500:0,990:1,998:2_京B10001,999:1552451707,1000:140205} 
	2019/03/13 12:35:07 Worker 1 send 2 records, sleep: 5000ms
	2019/03/13 12:35:07 Worker 0 sendto 192.168.100.49:57005 len:210, data:CAITS 0_0 70104_18700009651 150000 U_REPT {TYPE:0,RET:0,1:68874136,2:15422114,3:400,4:20190313/123507,5:0,6:4,7:10,8:0,9:10240,20:4,104:京A10000,202:2,500:0,990:1,998:2_京A10000,999:1552451707,1000:140205} 
	2019/03/13 12:35:07 RECV 192.168.100.49:57005 len:11, NOOP_ACK 

	2019/03/13 12:35:07 Worker 0 sendto 192.168.100.49:57005 len:210, data:CAITS 0_0 70104_18700009652 150000 U_REPT {TYPE:0,RET:0,1:68874136,2:15422114,3:400,4:20190313/123507,5:0,6:4,7:10,8:0,9:10240,20:4,104:京A10001,202:2,500:0,990:1,998:2_京A10001,999:1552451707,1000:140205} 
	2019/03/13 12:35:07 Worker 0 send 2 records, sleep: 5000ms

	2019/03/13 12:35:12 Worker 1 sendto 192.168.100.49:57005 len:210, data:CAITS 0_0 70105_18700009651 150000 U_REPT {TYPE:0,RET:0,1:68874137,2:15422115,3:400,4:20190313/123512,5:0,6:4,7:10,8:0,9:10240,20:4,104:京B10000,202:2,500:0,990:1,998:2_京B10000,999:1552451712,1000:140205} 
	2019/03/13 12:35:12 Worker 0 sendto 192.168.100.49:57005 len:210, data:CAITS 0_0 70104_18700009651 150000 U_REPT {TYPE:0,RET:0,1:68874137,2:15422115,3:400,4:20190313/123512,5:0,6:4,7:10,8:0,9:10240,20:4,104:京A10000,202:2,500:0,990:1,998:2_京A10000,999:1552451712,1000:140205} 
	2019/03/13 12:35:12 Worker 1 sendto 192.168.100.49:57005 len:210, data:CAITS 0_0 70105_18700009652 150000 U_REPT {TYPE:0,RET:0,1:68874137,2:15422115,3:400,4:20190313/123512,5:0,6:4,7:10,8:0,9:10240,20:4,104:京B10001,202:2,500:0,990:1,998:2_京B10001,999:1552451712,1000:140205} 
	2019/03/13 12:35:12 Worker 1 send 2 records, sleep: 5000ms
	2019/03/13 12:35:12 Worker 0 sendto 192.168.100.49:57005 len:210, data:CAITS 0_0 70104_18700009652 150000 U_REPT {TYPE:0,RET:0,1:68874137,2:15422115,3:400,4:20190313/123512,5:0,6:4,7:10,8:0,9:10240,20:4,104:京A10001,202:2,500:0,990:1,998:2_京A10001,999:1552451712,1000:140205} 
	2019/03/13 12:35:12 Worker 0 send 2 records, sleep: 5000ms

	与crazy不同的是：sim号采用的是配置的sim号


	可以用于基于特定车辆的测试场景。
	```

	示例3，配置如下：
	- send_thread: 1
	- send_type: record
	- sleep_time: 5000 
	- record_sleep: 1000


	```
	[chenbo@localhost msgtool]$ cat msgtool.txt 
	CAITS 0_0 70104_18700009651 150000 U_TEST {TYPE:4,5:0,6:4,7:10,8:0,9:10240,20:4,104:京A10000,202:2,500:0,990:1,998:2_京A10000,999:1552451707,1000:14020}
	CAITS 0_0 70104_18700009651 150000 U_TEST {TYPE:4,5:0,6:4,7:10,8:0,9:10240,20:4,104:京A10000,202:2,500:0,990:1,998:2_京A10000,999:1552451708,1000:14021}

	模拟不常见或者不存在（新）的内部协议。
	```


	```
	2019/03/13 12:40:55 Sendto 192.168.100.49:57005 test data by mode: record start!
	2019/03/13 12:40:55 SEND 192.168.100.49:57005 NOOP
	2019/03/13 12:40:55 RECV 192.168.100.49:57005 len:11, NOOP_ACK 

	2019/03/13 12:40:56 Worker 0 sendto 192.168.100.49:57005 len:156, data:CAITS 0_0 70104_18700009651 150000 U_TEST {TYPE:4,5:0,6:4,7:10,8:0,9:10240,20:4,104:京A10000,202:2,500:0,990:1,998:2_京A10000,999:1552451707,1000:14020}
	2019/03/13 12:40:57 Worker 0 sendto 192.168.100.49:57005 len:156, data:CAITS 0_0 70104_18700009651 150000 U_TEST {TYPE:4,5:0,6:4,7:10,8:0,9:10240,20:4,104:京A10000,202:2,500:0,990:1,998:2_京A10000,999:1552451708,1000:14021}
	2019/03/13 12:40:57 Worker 0 send 2 records, sleep: 5000ms

	2019/03/13 12:41:01 Worker 0 sendto 192.168.100.49:57005 len:156, data:CAITS 0_0 70104_18700009651 150000 U_TEST {TYPE:4,5:0,6:4,7:10,8:0,9:10240,20:4,104:京A10000,202:2,500:0,990:1,998:2_京A10000,999:1552451707,1000:14020}
	2019/03/13 12:41:02 Worker 0 sendto 192.168.100.49:57005 len:156, data:CAITS 0_0 70104_18700009651 150000 U_TEST {TYPE:4,5:0,6:4,7:10,8:0,9:10240,20:4,104:京A10000,202:2,500:0,990:1,998:2_京A10000,999:1552451708,1000:14021}
	2019/03/13 12:41:02 Worker 0 send 2 records, sleep: 5000ms

	可以用于特定测试等。
	```


